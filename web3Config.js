// require( 'db.js' );
var etherUnits = require("./lib/etherUnits.js");
var BigNumber = require('bignumber.js');
var Web3 = require('web3');
var _web3;
var _eth;
// var mongoose = require( 'mongoose' );
// var Block     = mongoose.model( 'Block' );

//----------------------config--------------------
var contractBytes = "0x69010f0cf064dd592000006002908155600060055561050060409081526001608090815260a092909252600460c052600860e052601061010090815260206101205261014091909152610160829052610180526102006101a08190526104006101c08190526108006101e0526110009091526120006102205261400061024052618000610260526201000061028052620200006102a052620400006102c052620800006102e052621000006103005262200000610320526240000061034052628000006103605263010000006103805263020000006103a05263040000006103c05263080000006103e05263100000009052632000000061042052634000000061044052638000000061046052640100000000610480526402000000006104a0526404000000006104c0526408000000006104e0526200014490600690602462000240565b503480156200015257600080fd5b506000805433600160a060020a03199182168117835560088054600181019091557ff3f7a9fe364faab93b216da50a3214154f22a0a2b415b23a84c8169e8b636ee3018054909216179055600460205260027f91da3fd0782e51c6b3986e9e672fd566868e71f3dbc2d6c2cd6fbb3e361af2a755603e7fc59312466997bb42aaaf719ece141047820e6b34531e1670dc1852a453648f0f55640ffffffffe7f724ad3d24f57aae4bebead5383879105ce62b9d5fa67d4343ae412b59bd7971d556064905260617f083fc81be30b6287dea23aa60f8ffaf268f507cdeac82ed9644e506b59c54ff055620002b9565b82805482825590600052602060002090810192821562000287579160200282015b8281111562000287578251829064ffffffffff1690559160200191906001019062000261565b506200029592915062000299565b5090565b620002b691905b80821115620002955760008155600101620002a0565b90565b611c3f80620002c96000396000f3006080604052600436106100e55763ffffffff7c01000000000000000000000000000000000000000000000000000000006000350416630340752f81146100e75780630d2cbe131461010857806341c0e1b51461012357806357246d23146101385780637cee9ee8146101695780637e0b9eea146101895780638da5cb5b146101b0578063b539cd55146101e1578063c1075329146101f6578063d06c54fb1461021a578063d579fd441461022f578063d6d30a5114610250578063d9747f5814610268578063df88126f14610280578063e1fdb4b414610295578063fbd668a9146102ad575b005b3480156100f357600080fd5b506100e5600160a060020a03600435166102c5565b34801561011457600080fd5b506100e56004356024356103a8565b34801561012f57600080fd5b506100e56105b5565b34801561014457600080fd5b5061014d6106d9565b604080516001608060020a039092168252519081900360200190f35b6100e560043560243560443560643560ff6084351660a43560c4356106e8565b34801561019557600080fd5b5061019e610dd5565b60408051918252519081900360200190f35b3480156101bc57600080fd5b506101c5610ddb565b60408051600160a060020a039092168252519081900360200190f35b3480156101ed57600080fd5b5061019e610dea565b34801561020257600080fd5b506100e5600160a060020a0360043516602435610df0565b34801561022657600080fd5b506100e5610f58565b34801561023b57600080fd5b506100e5600160a060020a0360043516610ffd565b34801561025c57600080fd5b506100e56004356110f4565b34801561027457600080fd5b506101c560043561127d565b34801561028c57600080fd5b5061014d6112a5565b3480156102a157600080fd5b506100e56004356112bb565b3480156102b957600080fd5b506100e56004356114b8565b600054600160a060020a03163314610327576040805160e560020a62461bcd0281526020600482015260266024820152600080516020611bf4833981519152604482015260d160020a6537bbb732b91702606482015290519081900360840190fd5b60085460021015610337576103a5565b600160a060020a038116151561034c57600080fd5b600880546001810182556000919091527ff3f7a9fe364faab93b216da50a3214154f22a0a2b415b23a84c8169e8b636ee301805473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a0383161790555b50565b6000808080805b6008548110156103f45760088054829081106103c757fe5b600091825260209091200154600160a060020a03163314156103ec57600191506103f4565b6001016103af565b81151561040057600080fd5b86604051602001808281526020019150506040516020818303038152906040526040518082805190602001908083835b6020831061044f5780518252601f199092019160209182019101610430565b51815160001960209485036101000a0190811690199190911617905260408051949092018490039093206000818152600790945292206002810154929950975090955050504384109050610513576040805160e560020a62461bcd02815260206004820152603360248201527f736574746c6542657420696e207468652073616d6520626c6f636b206173207060448201527f6c6163654265742c206f72206265666f72652e00000000000000000000000000606482015290519081900360840190fd5b60788301431115610594576040805160e560020a62461bcd02815260206004820152602260248201527f426c6f636b686173682063616e2774206265207175657269656420627920455660448201527f4d2e000000000000000000000000000000000000000000000000000000000000606482015290519081900360840190fd5b8286146105a057600080fd5b6105ac858589896115a7565b50505050505050565b600054600160a060020a03163314610617576040805160e560020a62461bcd0281526020600482015260266024820152600080516020611bf4833981519152604482015260d160020a6537bbb732b91702606482015290519081900360840190fd5b600354608060020a90046001608060020a0316156106cb576040805160e560020a62461bcd02815260206004820152604860248201527f416c6c20626574732073686f756c642062652070726f6365737365642028736560448201527f74746c6564206f7220726566756e64656429206265666f72652073656c662d6460648201527f657374727563742e000000000000000000000000000000000000000000000000608482015290519081900360a40190fd5b600054600160a060020a0316ff5b6003546001608060020a031681565b60008481526007602052604081206003810154909190819081908190650100000000009004600160a060020a031615610791576040805160e560020a62461bcd02815260206004820152602160248201527f4265742073686f756c6420626520696e20612027636c65616e2720737461746560448201527f2e00000000000000000000000000000000000000000000000000000000000000606482015290519081900360840190fd5b34935060018b1180156107a5575060648b11155b15156107fb576040805160e560020a62461bcd02815260206004820152601e60248201527f4d6f64756c6f2073686f756c642062652077697468696e2072616e67652e0000604482015290519081900360640190fd5b678ac7230489e80000841015801561081d575069010f0cf064dd592000008411155b1515610873576040805160e560020a62461bcd02815260206004820152601e60248201527f416d6f756e742073686f756c642062652077697468696e2072616e67652e0000604482015290519081900360640190fd5b60008c118015610891575060008b8152600460205260409020548c11155b15156108e7576040805160e560020a62461bcd02815260206004820152601c60248201527f4d61736b2073686f756c642062652077697468696e2072616e67652e00000000604482015290519081900360640190fd5b438a101561093f576040805160e560020a62461bcd02815260206004820152601360248201527f436f6d6d69742068617320657870697265642e00000000000000000000000000604482015290519081900360640190fd5b60016040805190810160405280601c81526020017f19457468657265756d205369676e6564204d6573736167653a0a3332000000008152508b8b60405160200180838152602001828152602001925050506040516020818303038152906040526040518082805190602001908083835b602083106109ce5780518252601f1990920191602091820191016109af565b51815160209384036101000a6000190180199092169116179052604051919093018190038120865190955090830193508392860191508083835b60208310610a275780518252601f199092019160209182019101610a08565b51815160209384036101000a600019018019909216911617905292019384525060408051808503815293820190819052835193945092839250908401908083835b60208310610a875780518252601f199092019160209182019101610a68565b6001836020036101000a0380198251168184511680821785525050505050509050019150506040518091039020898989604051600081526020016040526040518085600019166000191681526020018460ff1660ff1681526020018360001916600019168152602001826000191660001916815260200194505050505060206040516020810390808403906000865af1158015610b28573d6000803e3d6000fd5b505050602060405103519250610b3d83611927565b1515610b93576040805160e560020a62461bcd02815260206004820152601d60248201527f4543445341207369676e6174757265206973206e6f742076616c69642e000000604482015290519081900360640190fd5b610b9e848c8e61197b565b60025491935091508401821115610bff576040805160e560020a62461bcd02815260206004820152601a60248201527f6d617850726f666974206c696d69742076696f6c6174696f6e2e000000000000604482015290519081900360640190fd5b600380546001608060020a03608060020a808304821686018216810292821692909217808216850182166fffffffffffffffffffffffffffffffff19919091161792839055303183821692909304811691909101161115610caa576040805160e560020a62461bcd02815260206004820152601f60248201527f43616e6e6f74206166666f726420746f206c6f73652074686973206265742e00604482015290519081900360640190fd5b8385600001819055508a8560010160006101000a81548160ff021916908360ff1602179055504385600201819055508b8560030160006101000a81548164ffffffffff021916908364ffffffffff160217905550338560030160056101000a815481600160a060020a030219169083600160a060020a031602179055506005600081548092919060010191905055508460010160009054906101000a900460ff1660ff1633600160a060020a03168a7fcd3f64138f645ba9a63e71a378025bfda5a3d31f1e25bb744fc90e7cf6fdc7a88860030160009054906101000a900464ffffffffff16888a60020154604051808464ffffffffff1664ffffffffff168152602001838152602001828152602001935050505060405180910390a4505050505050505050505050565b60055481565b600054600160a060020a031681565b60025481565b600054600160a060020a03163314610e52576040805160e560020a62461bcd0281526020600482015260266024820152600080516020611bf4833981519152604482015260d160020a6537bbb732b91702606482015290519081900360840190fd5b3031811115610ed0576040805160e560020a62461bcd028152602060048201526024808201527f496e63726561736520616d6f756e74206c6172676572207468616e2062616c6160448201527f6e63652e00000000000000000000000000000000000000000000000000000000606482015290519081900360840190fd5b60035430316001608060020a03808316608060020a90930481169290920190911682011115610f49576040805160e560020a62461bcd02815260206004820152601160248201527f4e6f7420656e6f7567682066756e64732e000000000000000000000000000000604482015290519081900360640190fd5b610f54828283611b36565b5050565b600154600160a060020a03163314610fcc576040805160e560020a62461bcd02815260206004820152602660248201527f43616e206f6e6c792061636365707420707265617070726f766564206e657720604482015260d160020a6537bbb732b91702606482015290519081900360840190fd5b6001546000805473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a03909216919091179055565b600054600160a060020a0316331461105f576040805160e560020a62461bcd0281526020600482015260266024820152600080516020611bf4833981519152604482015260d160020a6537bbb732b91702606482015290519081900360840190fd5b600054600160a060020a03828116911614156110c5576040805160e560020a62461bcd02815260206004820152601d60248201527f43616e6e6f7420617070726f76652063757272656e74206f776e65722e000000604482015290519081900360640190fd5b6001805473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a0392909216919091179055565b600054600160a060020a03163314611156576040805160e560020a62461bcd0281526020600482015260266024820152600080516020611bf4833981519152604482015260d160020a6537bbb732b91702606482015290519081900360840190fd5b30318111156111d4576040805160e560020a62461bcd028152602060048201526024808201527f496e63726561736520616d6f756e74206c6172676572207468616e2062616c6160448201527f6e63652e00000000000000000000000000000000000000000000000000000000606482015290519081900360840190fd5b60035430316001608060020a03808316608060020a9093048116929092019091168201111561124d576040805160e560020a62461bcd02815260206004820152601160248201527f4e6f7420656e6f7567682066756e64732e000000000000000000000000000000604482015290519081900360640190fd5b600380546fffffffffffffffffffffffffffffffff1981166001608060020a039182169390930116919091179055565b600880548290811061128b57fe5b600091825260209091200154600160a060020a0316905081565b600354608060020a90046001608060020a031681565b6000818152600760205260408120805490918082151561134b576040805160e560020a62461bcd02815260206004820152602260248201527f4265742073686f756c6420626520696e20616e2027616374697665272073746160448201527f7465000000000000000000000000000000000000000000000000000000000000606482015290519081900360840190fd5b600284015460780143116113cf576040805160e560020a62461bcd02815260206004820152602260248201527f426c6f636b686173682063616e2774206265207175657269656420627920455660448201527f4d2e000000000000000000000000000000000000000000000000000000000000606482015290519081900360840190fd5b60008455600184015460038501546113f591859160ff9091169064ffffffffff1661197b565b600380546001608060020a03608060020a8083048216869003821602918116919091178082168490039091166fffffffffffffffffffffffffffffffff1991909116178155860154919350915061146090600160a060020a0365010000000000909104168480611b36565b5050600580546000190190555050600090815260076020526040812081815560018101805460ff191690556002810191909155600301805478ffffffffffffffffffffffffffffffffffffffffffffffffff19169055565b600054600160a060020a0316331461151a576040805160e560020a62461bcd0281526020600482015260266024820152600080516020611bf4833981519152604482015260d160020a6537bbb732b91702606482015290519081900360840190fd5b69010f0cf064dd592000008111156115a2576040805160e560020a62461bcd02815260206004820152602260248201527f6d617850726f6669742073686f756c6420626520612073616e65206e756d626560448201527f722e000000000000000000000000000000000000000000000000000000000000606482015290519081900360840190fd5b600255565b6001830154835460ff9091169060009081908190819081908190819081901515611641576040805160e560020a62461bcd02815260206004820152602260248201527f4265742073686f756c6420626520696e20616e2027616374697665272073746160448201527f7465000000000000000000000000000000000000000000000000000000000000606482015290519081900360840190fd5b6040805160208082018e90528c4082840152825180830384018152606090920192839052815191929182918401908083835b602083106116925780518252601f199092019160209182019101611673565b5181516020939093036101000a600019018019909116921691909117905260405192018290039091209a508b92508a9150508115156116cd57fe5b8d5460038f01549290910698506116ec918b9064ffffffffff1661197b565b909650945060009350839250602889116117205760038c0154600288900a1664ffffffffff161561171b578593505b611737565b60038c015464ffffffffff16871015611737578593505b600380546001608060020a03608060020a80830482168a900382160291161790558b5468056bc75e2d63100000116117b5576103e8898981151561177757fe5b0481151561178157fe5b0691506103788214156117b557600380546fffffffffffffffffffffffffffffffff1981169091556001608060020a031692505b838301156117c5578284016117c8565b60015b60038d0154604051919250650100000000009004600160a060020a0316906108fc8315029083906000818181858888f193505050501561187957808c60030160059054906101000a9004600160a060020a0316600160a060020a03168e7f6e73056f04e59b9775a04fe9801a805fbf3172ed588c7168fcc021c00ea75f79878f8d8d6040518085815260200184815260200183815260200182815260200194505050505060405180910390a46118c7565b60038c015460408051838152905165010000000000909204600160a060020a0316917fac464fe4d3a86b9121261ac0a01dd981bfe0777c7c9d9c8f4473d31a9c0f9d2d916020908290030190a25b50506005805460001901905550505060009788525050600760205250506040842084815560018101805460ff191690556002810194909455505050600301805478ffffffffffffffffffffffffffffffffffffffffffffffffff19169055565b600080805b60085481101561197457600880548290811061194457fe5b600091825260209091200154600160a060020a038581169116141561196c5760019150611974565b60010161192c565b5092915050565b600080600080600080861180156119a057506000878152600460205260409020548611155b15156119f6576040805160e560020a62461bcd02815260206004820152601d60248201527f57696e2070726f626162696c697479206f7574206f662072616e67652e000000604482015290519081900360640190fd5b68056bc75e2d63100000881015611a0e576000611a18565b670de0b6b3a76400005b93506000925060288711611a9057600091505b60065460ff83161015611a8b576006805460ff8416908110611a4957fe5b90600052602060002001548660068460ff16815481101515611a6757fe5b9060005260206000200154161415611a80576001909201915b600190910190611a2b565b611a94565b8592505b506000680340aad21b3b700000881015611acc57606483888a02811515611ab757fe5b04600202811515611ac457fe5b049050611b17565b68056bc75e2d63100000881015611af657606483888a02811515611aec57fe5b04811515611ac457fe5b6103e883888a02811515611b0657fe5b04600502811515611b1357fe5b0490505b838184898b02811515611b2657fe5b0403039450505050935093915050565b604051600160a060020a0384169083156108fc029084906000818181858888f1935050505015611bae5760408051600160a060020a03851681526020810184905280820183905290517f9643c1b5b172b26d5f028be7fe646349bd5e3cd9367bb18f9e825afa828b7d939181900360600190a1611bee565b604080518381529051600160a060020a038516917fac464fe4d3a86b9121261ac0a01dd981bfe0777c7c9d9c8f4473d31a9c0f9d2d919081900360200190a25b50505056004f6e6c794f776e6572206d6574686f64732063616c6c6564206279206e6f6e2da165627a7a7230582071af3adab5848283bf0888576b9d0ab943ae818f86651220392f8de29a86be310029";

var petContractABI = [{"constant":false,"inputs":[{"name":"_newCOO","type":"address"}],"name":"addCOO","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"reveal","type":"uint256"},{"name":"placeBlockNum","type":"uint256"}],"name":"settleBet","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"kill","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"jackpotSize","outputs":[{"name":"","type":"uint128"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"betMask","type":"uint256"},{"name":"modulo","type":"uint256"},{"name":"commitLastBlock","type":"uint256"},{"name":"commit","type":"uint256"},{"name":"v","type":"uint8"},{"name":"r","type":"bytes32"},{"name":"s","type":"bytes32"}],"name":"placeBet","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[],"name":"undealBetNum","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"maxProfit","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"beneficiary","type":"address"},{"name":"withdrawAmount","type":"uint256"}],"name":"withdrawFunds","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"acceptNextOwner","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_nextOwner","type":"address"}],"name":"approveNextOwner","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"increaseAmount","type":"uint256"}],"name":"increaseJackpot","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"cooAddress","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"lockedInBets","outputs":[{"name":"","type":"uint128"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"commit","type":"uint256"}],"name":"refundBet","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_maxProfit","type":"uint256"}],"name":"setMaxProfit","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"payable":true,"stateMutability":"payable","type":"fallback"},{"anonymous":false,"inputs":[{"indexed":true,"name":"commit","type":"uint256"},{"indexed":true,"name":"gambler","type":"address"},{"indexed":true,"name":"modulo","type":"uint8"},{"indexed":false,"name":"mask","type":"uint40"},{"indexed":false,"name":"amount","type":"uint256"},{"indexed":false,"name":"playceBlock","type":"uint256"}],"name":"OnPlaceBet","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"beneficiary","type":"address"},{"indexed":false,"name":"amount","type":"uint256"}],"name":"FailedPayment","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"beneficiary","type":"address"},{"indexed":false,"name":"totalAmount","type":"uint256"},{"indexed":false,"name":"amount","type":"uint256"}],"name":"Payment","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"commit","type":"uint256"},{"indexed":true,"name":"gambler","type":"address"},{"indexed":true,"name":"totalAmount","type":"uint256"},{"indexed":false,"name":"amount","type":"uint256"},{"indexed":false,"name":"reveal","type":"uint256"},{"indexed":false,"name":"entropy","type":"uint256"},{"indexed":false,"name":"dice","type":"uint256"}],"name":"SettleBetPayment","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"flag","type":"uint8"},{"indexed":true,"name":"dicePower","type":"uint256"},{"indexed":true,"name":"mask","type":"uint40"},{"indexed":false,"name":"diceWin","type":"uint256"}],"name":"TestLog","type":"event"}];

var debugMode = true;//是否为调试模式，调试模式将强制使用本地节点

var MaxEstimateGas = 3700000;//通过多次交易测试后选最大的gas
var contractAddress = null;//;//为null时可以通过deployContract请求来部署
var SecretSigner = "0xeb0e5b3c177c72235d07d8daa6e7ad8fe701e24a";
// var Croupier = "0xeb0e5b3c177c72235d07d8daa6e7ad8fe701e24a";//相当于COO
//代理商信息，第一个代理商同时也是合约发布者
var delegates = [];
delegates.push({"account":"0xeb0e5b3c177c72235d07d8daa6e7ad8fe701e24a", "latestNonce":-1, "privateKey":new Buffer('a6abcae8af8089b782b90ee864da0912320d31a83306b740d1a843108e8cfa9f', 'hex'), privateKeyStr:'0xa6abcae8af8089b782b90ee864da0912320d31a83306b740d1a843108e8cfa9f'});
delegates.push({"account":"0xc17f762282149f36f2b26bfee54aa8678b70c3a4", "latestNonce":-1, "privateKey":new Buffer('ef28d75985db54e454ae37882aeb0f8850f35f15c5d42f2c82e8cde277a1f5f0', 'hex'), privateKeyStr:'0xef28d75985db54e454ae37882aeb0f8850f35f15c5d42f2c82e8cde277a1f5f0'});
delegates.push({"account":"0x5b1b048bac797bd17d5c9eb04e575960ec25ed02", "latestNonce":-1, "privateKey":new Buffer('69a5f349e11d11ca0bc15c53a3b87443d20347daf7ca4ff7d7c286c3e8750391', 'hex'), privateKeyStr:'0x69a5f349e11d11ca0bc15c53a3b87443d20347daf7ca4ff7d7c286c3e8750391'});


//-----------------------------------------------
var petContract;
var subContract;

var startWeb3 = async function(cb) {
    var rpcURL;
    //为调试与发布模式强制设置一些值方便测试与提高安全性
    if(debugMode){
        contractAddress="0x5137814e854fa10ee6d8ac3ad836d345db6ed44e";
        // contractAddress="0x813f22b365a8d487225c642ba370e39eb95c9860";//t 
        // rpcURL = 'http://192.168.199.214:9646';//t 
        rpcURL = 'http://localhost:9646';
    }else{
        contractAddress="0x5137814e854fa10ee6d8ac3ad836d345db6ed44e";
        rpcURL = 'http://localhost:9646';
    }
    var  _web3 = new Web3(new Web3.providers.HttpProvider(rpcURL));
    // var _web3WS = new Web3(new Web3.providers.WebsocketProvider(_wsProvider));
    eth = _web3.eth;

    //有合约地址则获取合约实例，没有则通过deployContract接口部署，或者setContractAddr接口设置已有合约
    if(contractAddress!=null){
        petContract = new eth.Contract(petContractABI, contractAddress);
        try{
            var maxProfit = await petContract.methods.maxProfit().call();
            console.log(maxProfit);
        }catch(err){
            petContract = null;
            contractAddress = null;
        }
    }
    module.exports.contractAddress = contractAddress;
    
    //读取区块链上的nonce
    for(var i=0; i<delegates.length; i++){
        delegates[i].latestNonce = await eth.getTransactionCount(delegates[i].account)-1;
        console.log(delegates[i].account,' latestNonce:'+delegates[i].latestNonce);
    }
    
    
    module.exports.web3 = _web3;
    module.exports.petContract = petContract;
    module.exports.delegates = delegates;
    console.log('web3 start!');
    
    cb();
}

module.exports.startWeb3 = startWeb3;
module.exports.debugMode = debugMode;
module.exports.petContractABI = petContractABI;
module.exports.contractBytes = contractBytes;
module.exports.SecretSigner = SecretSigner;
// module.exports.Croupier = Croupier;
module.exports.MaxEstimateGas = MaxEstimateGas;
